
new_items = ["gps_data", "form_number",    "grant_agreement_number",    "upload_date",    "district_code",    "vdc_code",    "ward_code",    "enumeration_area",    "beneficiary_id",    "which_inspection",    "date_of_application",    "date_of_inspection",    "inspection_type",    "design_number",    "build_material",    "build_material_other",    "roof_and_materials_used",    "roof_and_materials_other",    "design_details",    "beneficiary_name",    "district",    "vdc_municipality",    "ward",    "edit_required",    "edit_required_details",    "tole",    "land_plot_number",    "phone_number",    "bank_select",    "bank_not_available_remarks",    "bank_name",    "bank_branch",    "bank_account_number",    "technical_support",    "organization",    "organization_others",    "trained_masons",    "type_of_soil",    "no1_a",    "no1_b",    "no1_c",    "no1_d",    "no1_e",    "no1_f",    "no1_g",    "i1_one_no2_a",    "i1_one_no2_b",    "i1_one_no2_c",    "i1_one_no2_d",    "i1_one_no2_e",    "i1_one_no3_a",    "i1_one_no3_b",    "i1_one_no3_c",    "i1_one_no4_a",    "i1_one_no4_b",    "i1_one_no4_c",    "i1_one_no4_d",    "i1_one_no4_e",    "i1_one_no4_f",    "i1_one_no5_a",    "i1_one_no5_b",    "i1_one_no5_c",    "i1_one_no5_d",    "i1_one_no6_a",    "i1_one_no6_b",    "i1_one_no6_c",    "i1_one_no6_d",    "i1_two_no2_a",    "i1_two_no2_b",    "i1_two_no2_c",    "i1_two_no2_d1",    "i1_two_no2_d2",    "i1_two_no3_a",    "i1_two_no3_b",    "i1_two_no3_c",    "i1_two_no3_d",    "i1_two_no3_e",    "i1_two_no4_a",    "i1_two_no4_b",    "i1_two_no4_c",    "i1_two_no5_a",    "i1_two_no5_b",    "i1_two_no5_c",    "i1_two_no5_d",    "i1_two_no6_a",    "i1_two_no6_b",    "i1_two_no6_c",    "i1_two_no6_d",    "i1_thr_no2_a",    "i1_thr_no2_b",    "i1_thr_no2_c",    "i1_thr_no2_d",    "i1_thr_no2_e",    "i1_thr_no2_f",    "i1_thr_no2_g",    "i1_thr_no3_a",    "i1_thr_no3_b",    "i1_thr_no3_c",    "i1_thr_no4_a",    "i1_thr_no4_b",    "i1_thr_no4_c",    "i1_thr_no4_d",    "i1_thr_no4_e",    "i1_thr_no5_a",    "i1_thr_no5_b",    "i1_thr_no5_c",    "i1_thr_no5_d",    "i1_thr_no6_a",    "i1_thr_no6_b",    "i1_thr_no6_c",    "i1_thr_no6_d",    "i1_thr_no6_e",    "i1_cm_no1_a",    "i1_cm_no1_b",    "i1_cm_no1_c",    "i1_cm_no1_d",    "i1_cm_no1_e",    "i1_cm_no1_f",    "i1_cm_no1_g",    "i1_cm_no2_a",    "i1_cm_no2_b",    "i1_cm_no2_c",    "i1_cm_no3_a",    "i1_cm_no3_b",    "i1_cm_no4_a",    "i1_cm_no4_b",    "i1_cm_no4_c",    "i1_cm_no4_d",    "i1_cm_no5_a",    "i1_cm_no5_b",    "i1_cm_no5_c",    "four_no1",    "four_no2",    "four_no3_a",    "four_no3_b",    "four_no3_c",    "four_no3_d",    "four_no4_a",    "four_no4_b",    "four_no4_c",    "four_no5_a",    "four_no5_b",    "four_no5_c",    "four_no6_a",    "four_no6_b",    "four_no6_c",    "four_no7_a",    "four_no7_b",    "four_no7_c",    "i2_one_no1_a",    "i2_one_no1_b",    "i2_one_no1_c",    "i2_one_no1_d",    "i2_one_no1_e",    "i2_one_no1_f",    "i2_one_no1_g",    "i2_one_no1_h",    "i2_one_no2_a",    "i2_one_no2_b",    "i2_one_no2_c",    "i2_one_no3_a",    "i2_one_no3_b",    "i2_one_no3_c",    "i2_one_no3_d",    "i2_one_no3_e",    "i2_one_no3_f",    "i2_one_no4_a",    "i2_one_no4_b",    "i2_one_no4_c",    "i2_one_no4_d",    "i2_one_no4_e",    "i2_one_no5_a",    "i2_one_no5_b",    "i2_one_no5_c",    "i2_one_no6_a",    "i2_one_no6_b",    "i2_one_no6_c",    "i2_one_no6_d",    "i2_one_no6_e",    "i2_one_no6_f",    "i2_one_no6_g",    "i2_one_no7_a",    "i2_one_no7_b",    "i2_one_no7_c",    "i2_one_no7_d",    "i2_one_no7_e",    "i2_one_no7_f",    "i2_two_no1_a",    "i2_two_no1_b",    "i2_two_no1_c",    "i2_two_no1_d",    "i2_two_no1_e",    "i2_two_no2_a",    "i2_two_no2_b",    "i2_two_no2_c",    "i2_two_no2_d",    "i2_two_no2_e",    "i2_two_no3_a",    "i2_two_no3_b",    "i2_two_no3_c",    "i2_two_no4_a",    "i2_two_no4_b",    "i2_two_no4_c",    "i2_two_no4_d",    "i2_two_no4_e",    "i2_two_no4_f",    "i2_two_no5_a",    "i2_two_no5_b",    "i2_two_no5_c",    "i2_two_no6_a",    "i2_two_no6_b",    "i2_two_no6_c",    "i2_two_no6_d",    "i2_two_no6_e",    "i2_two_no6_f",    "i2_thr_no1_a",    "i2_thr_no1_b",    "i2_thr_no1_c",    "i2_thr_no1_d",    "i2_thr_no1_e",    "i2_thr_no1_f",    "i2_thr_no1_g",    "i2_thr_no2_a",    "i2_thr_no2_b",    "i2_thr_no2_c",    "i2_thr_no3_a",    "i2_thr_no3_b",    "i2_thr_no3_c",    "i2_thr_no3_d",    "i2_thr_no3_e",    "i2_thr_no3_f",    "i2_thr_no4_a",    "i2_thr_no4_b",    "i2_thr_no4_c",    "i2_thr_no4_d",    "i2_thr_no4_e",    "i2_thr_no5_a",    "i2_thr_no5_b",    "i2_thr_no5_c",    "i2_thr_no6_a",    "i2_thr_no6_b",    "i2_thr_no6_c",    "i2_thr_no6_d",    "i2_thr_no6_e",    "i2_thr_no6_f",    "i2_thr_no6_g",    "i2_thr_no7_a",    "i2_thr_no7_b",    "i2_thr_no7_c",    "i2_thr_no7_d",    "i2_thr_no7_e",    "i2_thr_no7_f",    "i2_cm_no1_a",    "i2_cm_no1_b",    "i2_cm_no1_c",    "i2_cm_no1_d",    "i2_cm_no1_e",    "i2_cm_no1_f",    "i2_cm_no1_g",    "i2_cm_no2_a",    "i2_cm_no2_b",    "i2_cm_no2_c",    "i2_cm_no3_a",    "i2_cm_no3_b",    "i2_cm_no3_c",    "i2_cm_no4_a",    "i2_cm_no4_b",    "i2_cm_no4_c",    "i2_cm_no5_a",    "i2_cm_no5_b",    "i2_cm_no5_c",    "i2_cm_no5_d",    "i2_cm_no5_e",    "i2_cm_no6_a",    "i2_cm_no6_b",    "i2_cm_no6_c",    "i2_cm_no6_d",    "i2_cm_no6_e",    "i2_cm_no6_f",    "i3_one_no1_a",    "i3_one_no1_b",    "i3_one_no1_c",    "i3_one_no1_d",    "i3_one_no1_e",    "i3_one_no1_f",    "i3_one_no1_g",    "i3_one_no1_h",    "i3_one_no2_a",    "i3_one_no2_b",    "i3_one_no2_c",    "i3_one_no3_a",    "i3_one_no3_b",    "i3_one_no3_c",    "i3_one_no3_d",    "i3_one_no3_e",    "i3_one_no3_f",    "i3_one_no4_a",    "i3_one_no4_b",    "i3_one_no4_c",    "i3_one_no4_d",    "i3_one_no4_e",    "i3_one_no5_a",    "i3_one_no5_b",    "i3_one_no5_c",    "i3_one_no6_a",    "i3_one_no6_b",    "i3_one_no6_c",    "i3_one_no6_d",    "i3_one_no6_e",    "i3_one_no6_f",    "i3_one_no6_g",    "i3_one_no7_a",    "i3_one_no7_b",    "i3_one_no7_c",    "i3_one_no7_d",    "i3_one_no7_e",    "i3_one_no7_f",    "i3_two_no1_a",    "i3_two_no2_a",    "i3_two_no2_b",    "i3_two_no2_c",    "i3_thr_no1_a",    "i3_thr_no1_b",    "i3_thr_no1_c",    "i3_thr_no1_d",    "i3_thr_no1_e",    "i3_thr_no1_f",    "i3_thr_no1_g",    "i3_thr_no2_a",    "i3_thr_no2_b",    "i3_thr_no2_c",    "i3_thr_no3_a",    "i3_thr_no3_b",    "i3_thr_no3_c",    "i3_thr_no3_d",    "i3_thr_no3_e",    "i3_thr_no3_f",    "i3_thr_no4_a",    "i3_thr_no4_b",    "i3_thr_no4_c",    "i3_thr_no4_d",    "i3_thr_no4_e",    "i3_thr_no5_a",    "i3_thr_no5_b",    "i3_thr_no5_c",    "i3_thr_no6_a",    "i3_thr_no6_b",    "i3_thr_no6_c",    "i3_thr_no6_d",    "i3_thr_no6_e",    "i3_thr_no6_f",    "i3_thr_no6_g",    "i3_thr_no7_a",    "i3_thr_no7_b",    "i3_thr_no7_c",    "i3_thr_no7_d",    "i3_thr_no7_e",    "i3_thr_no7_f",#
    "photo_1",    "photo_2",    "photo_3",    "photo_4",    "photo_5",    "photo_of_house_plan",    "photo_1_name",    "photo_2_name",    "photo_3_name",    "photo_4_name",    "photo_5_name",    "house_plan_name",    "final_decision",    "final_decision_2",    "house_owner_s_name",    "relationship_to_house_owner",    "moud_dlpiu_engineer",    "engineer_post",    "moud_dlpiu_engineer_2",    "engineer_2_post",    "final_remarks",    "accept_the_entry",    "gps_taken",    "longitude",    "latitude",    "altitude"]


from inspection.models.csweb import OldInspectionApplicationDict
import json
from pprint import pprint

def find_keys(item, parent_key=None):
    global parsed_dict
    key_list = []
    if type(item) == dict:
        child_keys = []
        new_keys = []
        for k in item.keys():


            child_keys = child_keys + find_keys(item[k], k)


            # s = "two_no2_d"
            # if s == k.lower()[-len(s):]:
            #     print(parsed_dict)
            #     return "skdfj"
            # if k[-2:].lower() == "_1":
            #     continue

            if parent_key and "part_2" in parent_key.lower():
                if k[-2:].lower() == "_1":
                    continue
                new_keys.append(k)


            elif parent_key and "annex" in parent_key.lower() and "annex_12" not in parent_key.lower():
                if k[-2:].lower() == "_1":
                    continue
                new_keys.append("i1_"+k)
            else:
                new_keys.append(k)
        key_list = new_keys + child_keys
    key_list = [k.lower() for k in key_list]
    return key_list

def get_standard_data(item):

    ## Rename top leve keys
    std_item = item.copy()
    # std_item["INSPECTION_RECORD"]["WHICH_INSPECTION"] = 
    std_item["INSPECTION_RECORD"]["DATE_OF_INSPECTION"] = std_item["INSPECTION_RECORD"].pop("INSPECTION_DATE")
    std_item['BENEFICIARY_RECORD'] = std_item.pop('BENEFICIARY_INFORMATION')
    std_item["APPLICATION_RECORD"] = {"WHICH_INSPECTION": std_item["INSPECTION_RECORD"].pop("INSPECTION_NUMBER"),
    "DATE_OF_APPLICATION": std_item["INSPECTION_RECORD"]["DATE_OF_INSPECTION"] }
    std_item["FINAL_APPROVAL"]["ENGINEER_2_POST"] = ""
    std_item["FINAL_APPROVAL"]["MOUD_DLPIU_ENGINEER_2"] = ""

    ## fix annex and part keys
    main_keys = std_item.keys()
    for k in main_keys:
        keys = list(std_item[k].keys())
        if "annex" in k.lower() and "annex_12" not in k.lower():
            for nk in keys:
                if nk[-2:].lower() == "_1":
                    std_item[k].pop(nk)
                else:
                    std_item[k]["I1_"+nk] = std_item[k].pop(nk)
        elif "part_2" in k.lower():
            for nk in keys:
                if nk[-2:].lower() == "_1":
                    std_item[k].pop(nk)
        if "annex" in k.lower() and "." in k.lower():
            std_item[k.replace(".", "_")] = std_item.pop(k)

    return std_item

def diff(first, second):
    return set(first) - set(second)

inspections = OldInspectionApplicationDict.objects.all()



not_found = set()
counter = 0 
insp_numbers = set()

null_insp_no = 0
for insp in inspections:
    # print("gone")
    parsed_dict = insp.get_parsed_data()
    std_dict = get_standard_data(parsed_dict)
    std_dict
    # pprint(json.dumps())
    break
    insp_number = parsed_dict.get("INSPECTION_RECORD").get("INSPECTION_NUMBER")
    if insp_number =="":
        null_insp_no += 1
    insp_numbers.add(insp_number)
    item = find_keys(parsed_dict)
    # print('gone')
    not_found = set(list(not_found) + list(diff(item, new_items)))
    # print("gone")
    counter += 1
    if counter % 1000 == 0:
        print(counter)


        print(list(not_found))

print(insp_numbers)

